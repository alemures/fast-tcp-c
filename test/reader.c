#include <stdlib.h>
#include "../src/ft_reader.h"
#include "../src/ft_util.h"

int main(int argc, char *argv[]) {
    struct ft_reader *reader = ft_readerCreate();

    // dt=4,mt=2,messageId=1,event="The event",data=21.100000
    unsigned char chunk[] = {
        0x1f, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x02, 0x01, 0x00, 0x00, 0x00, 0x09,
        0x00, 0x54, 0x68, 0x65, 0x20, 0x65, 0x76, 0x65, 0x6e, 0x74, 0x08, 0x00, 0x00,
        0x00, 0x9a, 0x99, 0x99, 0x99, 0x99, 0x19, 0x35, 0x40,

        0x1f, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x02, 0x01, 0x00, 0x00, 0x00, 0x09,
        0x00, 0x54, 0x68, 0x65, 0x20, 0x65, 0x76, 0x65, 0x6e, 0x74, 0x08, 0x00, 0x00,
        0x00, 0x9a, 0x99, 0x99, 0x99, 0x99, 0x19, 0x35, 0x40,

        0x1f, 0x00, 0x00, 0x00, 0x01, 0x00, 0x04, 0x02, 0x01, 0x00, 0x00, 0x00, 0x09,
        0x00, 0x54, 0x68, 0x65, 0x20, 0x65, 0x76, 0x65, 0x6e, 0x74, 0x08, 0x00, 0x00,
        0x00, 0x9a, 0x99, 0x99, 0x99, 0x99, 0x19, 0x35, 0x40
    };
    int chunkLength = 35 * 3;

    unsigned char **buffers = ft_readerRead(reader, chunk, chunkLength);
    for (int i = 0; i < reader->buffersRead; i++) {
        ft_utilPrintBytes(buffers[i], 35);
        free(buffers[i]);
    }
    free(buffers);
    ft_readerDestroy(reader);

    return 0;
}
